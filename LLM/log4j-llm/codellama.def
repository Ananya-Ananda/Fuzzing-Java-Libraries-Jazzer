Bootstrap: docker
From: pytorch/pytorch:2.1.0-cuda12.1-cudnn8-runtime

%post
    apt-get update && apt-get install -y --no-install-recommends \
        git \
        python3-pip \
        python3-dev \
        openjdk-11-jdk \
        maven \
        && rm -rf /var/lib/apt/lists/*
    
    # Install necessary packages for LLM and Java integration
    pip3 install --no-cache-dir \
        transformers==4.36.0 \
        accelerate==0.25.0 \
        sentencepiece==0.1.99 \
        huggingface_hub==0.19.4 \
        scipy==1.11.3 \
        scikit-learn==1.3.2 \
        numpy==1.24.4 \
        pandas==2.1.1 \
        tqdm==4.66.1 \
        peft==0.6.0 \
        bitsandbytes==0.41.1

    # Create directory for model storage
    mkdir -p /scratch_mount
    mkdir -p /app

%environment
    export TRANSFORMERS_CACHE=/scratch_mount
    export HF_HOME=/scratch_mount
    export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
    export PATH=$JAVA_HOME/bin:$PATH
    export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib/jvm/java-11-openjdk-amd64/lib

%runscript
    exec python3 "$@"
    